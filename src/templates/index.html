<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RSS Feeds</title>
    <!-- Primer CSS -->
    <link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
    <style>
        .sidebar {
            width: 250px;
            min-height: 100vh;
            border-right: 1px solid var(--color-border-default);
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                min-height: auto;
                border-right: none;
                border-bottom: 1px solid var(--color-border-default);
            }
            .layout-wrapper {
                flex-direction: column;
            }
        }
    </style>
    <script>
        function filterByCategory(category) {
            const feedItems = document.querySelectorAll('.Box-row');
            const activeItems = document.querySelectorAll('.menu-item');
            
            // Update active state in sidebar
            activeItems.forEach(item => {
                item.classList.remove('selected');
                if(item.getAttribute('data-category') === category) {
                    item.classList.add('selected');
                }
            });

            // Show all if "All" is selected
            if(category === 'all') {
                feedItems.forEach(item => item.style.display = 'block');
                return;
            }

            // Filter items
            feedItems.forEach(item => {
                const itemCategory = item.getAttribute('data-category');
                item.style.display = itemCategory === category ? 'block' : 'none';
            });
        }
    </script>
</head>
<body>
    <div class="layout-wrapper d-flex">
        <!-- New Sidebar -->
        <div class="sidebar p-3">
            <nav class="menu">
                <span class="menu-heading">Categories</span>
                <a class="menu-item selected" href="javascript:void(0)" 
                   onclick="filterByCategory('all')" data-category="all">
                    All Feeds
                    <span class="Counter">{{ feeds|length }}</span>
                </a>
                
                <!-- Show uncategorized first -->
                <a class="menu-item" href="javascript:void(0)" 
                   onclick="filterByCategory('uncategorized')" data-category="uncategorized">
                    Uncategorized
                    <span class="Counter">{{ category_counts.get('uncategorized', 0) }}</span>
                </a>

                <!-- Show all other categories alphabetically -->
                {% for category in categories|sort %}
                    {% if category and category != 'uncategorized' %}
                    <a class="menu-item" href="javascript:void(0)" 
                       onclick="filterByCategory('{{ category }}')" data-category="{{ category }}">
                        {{ category }}
                        <span class="Counter">{{ category_counts.get(category, 0) }}</span>
                    </a>
                    {% endif %}
                {% endfor %}
            </nav>
        </div>

        <!-- Main Content -->
        <div class="container-lg px-3 py-6">
            <h1 class="h1 mb-4">RSS Feeds</h1>
            
            <div class="Box">
                {% for feed in feeds %}
                <div class="Box-row" data-category="{{ feed.get('category', 'uncategorized') }}">
                    <div class="d-flex flex-column">
                        <h2 class="h3 mb-1">
                            <a href="{{ feed.link }}" class="Link--primary">
                                {{ feed.ai_title }}
                            </a>
                        </h2>
                        {% if feed.summary %}
                        <p class="color-text-secondary mb-2">{{ feed.summary }}</p>
                        {% endif %}
                        <div class="d-flex flex-items-center color-text-tertiary">
                            <span class="mr-3">
                                {% if feed.pub_date %}
                                    {{ feed.pub_date.strftime('%Y-%m-%d %H:%M') if feed.pub_date is not string else feed.pub_date }}
                                {% endif %}
                            </span>
                            {% if feed.category %}
                            <span class="Label">{{ feed.category }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</body>
</html>
